<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>青鬼オンライン</title>
    <style>
        body {
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            margin: 0;
            background-color: #333;
        }
        #gameCanvas {
            background-color: white;
            border: 2px solid black;
        }
    </style>
</head>
<body>
    <canvas id="gameCanvas" width="800" height="600"></canvas>
    <script>
        const canvas = document.getElementById('gameCanvas');
        const context = canvas.getContext('2d');

        const player = {
            x: 50,
            y: 50,
            width: 30,
            height: 30,
            color: 'blue',
            speed: 5
        };

        const enemy = {
            x: canvas.width - 100,
            y: canvas.height - 100,
            width: 30,
            height: 30,
            color: 'red',
            speed: 2
        };

        const walls = [
            { x: 100, y: 100, width: 200, height: 20 },
            { x: 100, y: 300, width: 200, height: 20 },
            { x: 400, y: 200, width: 20, height: 200 }
        ];

        const doors = [
            { x: 700, y: 50, width: 50, height: 20 },
            { x: 50, y: 500, width: 20, height: 50 }
        ];

        const obstacles = [
            { x: 300, y: 150, width: 50, height: 50 },
            { x: 500, y: 400, width: 50, height: 50 }
        ];

        function drawRect(rect, color) {
            context.fillStyle = color;
            context.fillRect(rect.x, rect.y, rect.width, rect.height);
        }

        function drawPlayer() {
            drawRect(player, player.color);
        }

        function drawEnemy() {
            drawRect(enemy, enemy.color);
        }

        function drawWalls() {
            walls.forEach(wall => drawRect(wall, 'black'));
        }

        function drawDoors() {
            doors.forEach(door => drawRect(door, 'brown'));
        }

        function drawObstacles() {
            obstacles.forEach(obstacle => drawRect(obstacle, 'gray'));
        }

        function moveEnemy() {
            const dx = player.x - enemy.x;
            const dy = player.y - enemy.y;
            const distance = Math.sqrt(dx * dx + dy * dy);

            if (distance > 0) {
                enemy.x += (dx / distance) * enemy.speed;
                enemy.y += (dy / distance) * enemy.speed;
            }
        }

        function isColliding(rect1, rect2) {
            return (
                rect1.x < rect2.x + rect2.width &&
                rect1.x + rect1.width > rect2.x &&
                rect1.y < rect2.y + rect2.height &&
                rect1.y + rect1.height > rect2.y
            );
        }

        function handleCollisions() {
            walls.concat(obstacles).forEach(wall => {
                if (isColliding(player, wall)) {
                    if (player.x + player.width > wall.x && player.x < wall.x + wall.width) {
                        if (player.y + player.height > wall.y && player.y < wall.y + wall.height) {
                            if (player.y < wall.y) {
                                player.y = wall.y - player.height;
                            } else {
                                player.y = wall.y + wall.height;
                            }
                        }
                    }
                    if (player.y + player.height > wall.y && player.y < wall.y + wall.height) {
                        if (player.x + player.width > wall.x && player.x < wall.x + wall.width) {
                            if (player.x < wall.x) {
                                player.x = wall.x - player.width;
                            } else {
                                player.x = wall.x + wall.width;
                            }
                        }
                    }
                }
            });
        }

        function update() {
            context.clearRect(0, 0, canvas.width, canvas.height);
            drawPlayer();
            drawEnemy();
            drawWalls();
            drawDoors();
            drawObstacles();
            moveEnemy();
            handleCollisions();
            requestAnimationFrame(update);
        }

        document.addEventListener('keydown', function(event) {
            switch (event.key) {
                case 'ArrowUp':
                    player.y -= player.speed;
                    break;
                case 'ArrowDown':
                    player.y += player.speed;
                    break;
                case 'ArrowLeft':
                    player.x -= player.speed;
                    break;
                case 'ArrowRight':
                    player.x += player.speed;
                    break;
            }
            handleCollisions();
        });

        update();
    </script>
</body>
</html>
